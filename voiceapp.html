<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 1em;
            border: none;
            border-radius: 5px;
            color: white;
            background-color: #007BFF;
            cursor: pointer;
        }
        button:disabled {
            background-color: #ccc;
        }
        audio {
            display: block;
            width: 100%;
            margin-top: 20px;
        }
        canvas {
            display: block;
            width: 100%;
            margin-top: 20px;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.9.359/pdf.js"></script>
</head>
<body>

<button id="startBtn" onclick="startRecording()">Start Recording</button>
<button id="stopBtn" onclick="stopRecording()" disabled>Stop Recording</button>
<button id="displayBtn" onclick="displayDocument()" disabled>Display Document</button>
<audio id="replay" controls></audio>
<canvas id="pdfCanvas"></canvas>

<script>
let mediaRecorder;
let recordedChunks = [];

async function startRecording() {
    let stream = await navigator.mediaDevices.getUserMedia({ audio: true });
    mediaRecorder = new MediaRecorder(stream);
    mediaRecorder.start();

    mediaRecorder.ondataavailable = function(e) {
        recordedChunks.push(e.data);
    };

    document.getElementById('startBtn').disabled = true;
    document.getElementById('stopBtn').disabled = false;
}

async function stopRecording() {
    mediaRecorder.stop();

    let blob = new Blob(recordedChunks, {
        type: 'audio/wav'
    });

    // Replay the recorded audio
    let audioURL = URL.createObjectURL(blob);
    document.getElementById('replay').src = audioURL;

    let formData = new FormData();
    formData.append('audio', blob, 'audio.wav');

    let response = await fetch('http://localhost:5000/transcribe', {
        method: 'POST',
        body: formData
    });

    let data = await response.json();
    console.log(data);

    // Create a PDF document from the transcribed text
    let doc = new jsPDF.jsPDF();
    doc.text(data.transcription, 10, 10);
    let pdfBlob = doc.output('blob');

    // Save the PDF blob for later use
    window.pdfBlob = pdfBlob;

    document.getElementById('startBtn').disabled = false;
    document.getElementById('stopBtn').disabled = true;
    document.getElementById('displayBtn').disabled = false;
}

// Function to display the PDF document
async function displayDocument() {
    let pdf = await pdfjsLib.getDocument({data: window.pdfBlob}).promise;
    let page = await pdf.getPage(1);
    let scale = 1.5;
    let viewport = page.getViewport({scale: scale});

    let canvas = document.getElementById('pdfCanvas');
    canvas.width = viewport.width;
    canvas.height = viewport.height;

    let renderContext = {
        canvasContext: canvas.getContext('2d'),
        viewport: viewport
    };
    page.render(renderContext);
}
</script>

</body>
</html>